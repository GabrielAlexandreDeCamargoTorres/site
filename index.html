<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Defesa Quadrado</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #121212;
      font-family: sans-serif;
      color: white;
    }

    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #1e1e1e;
    }

    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      padding: 10px;
      border-radius: 8px;
    }

    button {
      margin-top: 5px;
      display: block;
      width: 180px;
      padding: 6px;
      border: none;
      background: #444;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #666;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="ui">
  <div id="stats">
    <div>üíÄ Kills: <span id="kills">0</span></div>
    <div>‚ù§Ô∏è HP: <span id="hp">10</span></div>
    <div>‚ö° Atk Speed: <span id="speed">1000ms</span></div>
  </div>
  <button onclick="upgradeSpeed()">‚ö° Atirar Mais R√°pido (10)</button>
  <button onclick="upgradeHP()">‚ù§Ô∏è Mais HP (10)</button>
  <button onclick="upgradeDoublePoints()">‚ú® Pontos em Dobro (25)</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const center = { x: canvas.width / 2, y: canvas.height / 2 };

let player = {
  x: center.x,
  y: center.y,
  size: 20,
  hp: 10,
  maxHp: 10,
  speed: 1000,
  lastShot: 0
};

let enemies = [];
let projectiles = [];
let kills = 0;
let points = 0;
let doublePoints = false;

function spawnEnemy() {
  const edge = Math.floor(Math.random() * 4);
  let x, y;

  if (edge === 0) { x = 0; y = Math.random() * canvas.height; }
  if (edge === 1) { x = canvas.width; y = Math.random() * canvas.height; }
  if (edge === 2) { x = Math.random() * canvas.width; y = 0; }
  if (edge === 3) { x = Math.random() * canvas.width; y = canvas.height; }

  enemies.push({ x, y, size: 15, speed: 1.2 });
}

function drawPlayer() {
  ctx.fillStyle = '#4a90e2';
  ctx.fillRect(player.x - player.size / 2, player.y - player.size / 2, player.size, player.size);
}

function drawEnemies() {
  ctx.fillStyle = 'red';
  enemies.forEach(e => {
    ctx.fillRect(e.x - e.size / 2, e.y - e.size / 2, e.size, e.size);
  });
}

function drawProjectiles() {
  ctx.fillStyle = 'white';
  projectiles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
    ctx.fill();
  });
}

function updateEnemies() {
  enemies.forEach(e => {
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.hypot(dx, dy);
    e.x += dx / dist * e.speed;
    e.y += dy / dist * e.speed;

    if (dist < (e.size + player.size) / 2) {
      player.hp--;
      enemies.splice(enemies.indexOf(e), 1);
    }
  });
}

function updateProjectiles() {
  projectiles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;

    enemies.forEach(e => {
      const dx = p.x - e.x;
      const dy = p.y - e.y;
      if (Math.hypot(dx, dy) < e.size / 2) {
        points += doublePoints ? 2 : 1;
        kills++;
        enemies.splice(enemies.indexOf(e), 1);
        projectiles.splice(projectiles.indexOf(p), 1);
      }
    });
  });

  projectiles = projectiles.filter(p => p.x >= 0 && p.x <= canvas.width && p.y >= 0 && p.y <= canvas.height);
}

function shootClosestEnemy() {
  if (Date.now() - player.lastShot < player.speed) return;
  player.lastShot = Date.now();

  if (enemies.length === 0) return;

  let closest = enemies[0];
  let closestDist = Infinity;

  enemies.forEach(e => {
    const dist = Math.hypot(player.x - e.x, player.y - e.y);
    if (dist < closestDist) {
      closestDist = dist;
      closest = e;
    }
  });

  const dx = closest.x - player.x;
  const dy = closest.y - player.y;
  const dist = Math.hypot(dx, dy);
  const speed = 5;

  projectiles.push({
    x: player.x,
    y: player.y,
    vx: dx / dist * speed,
    vy: dy / dist * speed
  });
}

function updateUI() {
  document.getElementById('kills').innerText = kills;
  document.getElementById('hp').innerText = player.hp;
  document.getElementById('speed').innerText = player.speed + "ms";
}

function upgradeSpeed() {
  if (points >= 10 && player.speed > 200) {
    points -= 10;
    player.speed -= 150;
  }
}

function upgradeHP() {
  if (points >= 10) {
    points -= 10;
    player.hp++;
    player.maxHp++;
  }
}

function upgradeDoublePoints() {
  if (points >= 25 && !doublePoints) {
    points -= 25;
    doublePoints = true;
  }
}

function gameLoop() {
  if (player.hp <= 0) {
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'white';
    ctx.font = '30px sans-serif';
    ctx.fillText('Game Over', canvas.width / 2 - 80, canvas.height / 2);
    return;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPlayer();
  drawEnemies();
  drawProjectiles();
  updateEnemies();
  updateProjectiles();
  shootClosestEnemy();
  updateUI();

  requestAnimationFrame(gameLoop);
}

// Spawn inimigos a cada 1s
setInterval(spawnEnemy, 1000);
requestAnimationFrame(gameLoop);
</script>
</body>
</html>
