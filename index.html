<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batalha estilo Undertale</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #222;
      font-family: sans-serif;
    }

    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #000;
    }

    #healthBar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: green;
      height: 20px;
      width: 100%;
    }

    #playerHealth {
      background: red;
      height: 100%;
      width: 100%;
    }

    #enemyHealth {
      background: blue;
      height: 100%;
      width: 100%;
    }

    #ui {
      position: absolute;
      top: 10px;
      right: 10px;
      color: white;
      font-size: 20px;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    }

    .attackText {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      color: white;
      opacity: 0;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="ui">
  <div>HP do Jogador: <span id="playerHP">100</span></div>
  <div>HP do Inimigo: <span id="enemyHP">100</span></div>
</div>
<div id="healthBar">
  <div id="playerHealth"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = {
  x: canvas.width / 2,
  y: canvas.height - 50,
  width: 50,
  height: 20,
  speed: 5,
  hp: 100
};

let enemy = {
  x: canvas.width / 2 - 25,
  y: 50,
  width: 50,
  height: 50,
  hp: 100
};

let bullets = [];
let attackText = document.createElement('div');
attackText.className = 'attackText';
document.body.appendChild(attackText);

let keys = {};

let gameOver = false;
let attacking = false;

function drawPlayer() {
  ctx.fillStyle = 'green';
  ctx.fillRect(player.x - player.width / 2, player.y, player.width, player.height);
}

function drawEnemy() {
  ctx.fillStyle = 'red';
  ctx.fillRect(enemy.x - enemy.width / 2, enemy.y, enemy.width, enemy.height);
}

function drawBullets() {
  bullets.forEach(bullet => {
    ctx.fillStyle = 'yellow';
    ctx.fillRect(bullet.x, bullet.y, 10, 20);
  });
}

function updateBullets() {
  bullets.forEach((bullet, index) => {
    bullet.y += 5;  // velocidade da bala
    if (bullet.y > canvas.height) {
      bullets.splice(index, 1); // Remove a bala quando ela sai da tela
    }

    // Verifica colisão com o jogador
    if (bullet.x >= player.x - player.width / 2 && bullet.x <= player.x + player.width / 2 &&
        bullet.y + 20 >= player.y && bullet.y <= player.y + player.height) {
      player.hp -= 10; // Diminui vida do jogador
      bullets.splice(index, 1);
    }

    // Verifica colisão com o inimigo (para simular dano)
    if (bullet.x >= enemy.x - enemy.width / 2 && bullet.x <= enemy.x + enemy.width / 2 &&
        bullet.y + 20 >= enemy.y && bullet.y <= enemy.y + enemy.height) {
      enemy.hp -= 10; // Diminui vida do inimigo
      bullets.splice(index, 1);
    }
  });
}

function drawAttackText() {
  if (attacking) {
    attackText.innerText = 'ATACANDO!';
    attackText.style.opacity = 1;
  } else {
    attackText.style.opacity = 0;
  }
}

function movePlayer() {
  if (keys['ArrowLeft'] && player.x - player.width / 2 > 0) player.x -= player.speed;
  if (keys['ArrowRight'] && player.x + player.width / 2 < canvas.width) player.x += player.speed;
}

function createBullet() {
  if (!attacking) {
    bullets.push({ x: player.x, y: player.y - player.height / 2 });
    attacking = true;
    setTimeout(() => attacking = false, 500); // Aguarda meio segundo antes de poder atacar novamente
  }
}

function updateUI() {
  document.getElementById('playerHP').innerText = player.hp;
  document.getElementById('enemyHP').innerText = enemy.hp;
  document.getElementById('playerHealth').style.width = (player.hp / 100) * 100 + '%';
}

function gameLoop() {
  if (gameOver) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  movePlayer();
  drawPlayer();
  drawEnemy();
  drawBullets();
  updateBullets();
  drawAttackText();
  updateUI();

  if (enemy.hp <= 0 || player.hp <= 0) {
    gameOver = true;
    const winner = player.hp <= 0 ? 'Inimigo' : 'Jogador';
    attackText.innerText = `${winner} Venceu!`;
    attackText.style.opacity = 1;
  }

  requestAnimationFrame(gameLoop);
}

// Controle do teclado
window.addEventListener('keydown', (e) => {
  keys[e.key] = true;
  if (e.key === ' ' && !attacking) { // Tecla de espaço para atacar
    createBullet();
  }
});

window.addEventListener('keyup', (e) => {
  keys[e.key] = false;
});

gameLoop();
</script>

</body>
</html>
